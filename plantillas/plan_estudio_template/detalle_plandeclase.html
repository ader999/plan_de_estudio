<div class="container mt-4 silabo-component">

    <script>
        // Función para imprimir el sílabo
        function imprimirSilabo() {
            window.print();
        }

        // Función para filtrar por número de encuentro
        function filtrarPorEncuentro(codigo, numero) {
            // Ocultar todos los planes para este código
            document.querySelectorAll(`.plan-${codigo}`).forEach(plan => {
                plan.style.display = 'none';
            });
            
            // Mostrar solo el plan con el número de encuentro seleccionado
            document.querySelector(`.plan-${codigo}-${numero}`).style.display = 'block';
            
            // Actualizar estado visual de los botones
            document.querySelectorAll(`.btn-encuentro-${codigo}`).forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-outline-primary');
            });
            
            document.querySelector(`.btn-encuentro-${codigo}-${numero}`).classList.remove('btn-outline-primary');
            document.querySelector(`.btn-encuentro-${codigo}-${numero}`).classList.add('btn-primary');
        }
        
        // Inicializar mostrar solo el primer encuentro al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            // Inicialización para el acordeón que está abierto por defecto
            const primerAcordeon = document.querySelector('.accordion-collapse.show');
            if (primerAcordeon) {
                const codigo = primerAcordeon.id.replace('collapse-', '');
                inicializarFiltrado(codigo);
            }
            
            // Escuchar eventos de apertura de acordeones
            document.querySelectorAll('.accordion-collapse').forEach(function(collapse) {
                collapse.addEventListener('shown.bs.collapse', function() {
                    const codigo = this.id.replace('collapse-', '');
                    inicializarFiltrado(codigo);
                });
            });
        });
        
        // Función para inicializar el filtrado en un acordeón específico
        function inicializarFiltrado(codigo) {
            // Ocultar todos los encuentros primero
            document.querySelectorAll(`.plan-${codigo}`).forEach(plan => {
                plan.style.display = 'none';
            });
            
            // Encontrar el primer encuentro y mostrarlo
            const primerBoton = document.querySelector(`.btn-encuentro-${codigo}`);
            if (primerBoton) {
                const encuentroNum = primerBoton.getAttribute('data-encuentro');
                filtrarPorEncuentro(codigo, encuentroNum);
            }
        }
    </script>

    <!-- Estilos personalizados -->
    <style>
        .plan-card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .plan-header {
            background: linear-gradient(135deg, var(--color-azul-2), var(--color-azul-oscuro));
            color: white;
            padding: 15px;
            border-radius: 10px 10px 0 0;
            position: relative;
        }
        
        .plan-header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--color-azul-1), var(--color-azul-3));
        }
        
        .plan-section {
            border-left: 4px solid var(--color-azul-3);
            margin-bottom: 15px;
            padding-left: 10px;
        }
        
        .plan-section-title {
            background-color: var(--color-gris-1);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .filter-buttons .btn {
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }
        
        .filter-buttons .btn.btn-primary {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .data-table {
            width: 100%;
            margin-bottom: 1rem;
        }
        
        .data-table td:first-child {
            font-weight: bold;
            width: 35%;
            color: var(--color-azul-oscuro);
        }
        
        .accordion-button:not(.collapsed) {
            background-color: var(--color-azul-3);
            color: white;
        }
        
        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(46, 134, 193, 0.25);
        }
        
        .accordion-item {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.125);
        }
        
        .content-item {
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            margin-bottom: 10px;
        }
        
        .badge {
            padding: 0.5em 0.8em;
        }

        @media print {
            .filter-buttons, .btn-encuentro {
                display: none !important;
            }
            
            .plan-card {
                box-shadow: none;
                break-inside: avoid;
                page-break-inside: avoid;
                margin-bottom: 30px;
            }
            
            .plan-container {
                display: block !important;
            }
            
            .plan-container > div {
                display: block !important;
                width: 100% !important;
            }
        }
    </style>

    <!-- Acordeón -->
    <div class="accordion" id="accordionSilabos">
        {% for codigo, silabos_grupo in silabos_agrupados.items %}
        <div class="accordion-item mb-4">
            <h2 class="accordion-header" id="heading-{{ codigo }}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ codigo }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse-{{ codigo }}">
                    <div class="d-flex flex-column flex-md-row justify-content-between w-100">
                        <div>
                            <strong>📝 Plan de Clase: {{ codigo }}</strong>
                        </div>
                        <div class="d-flex gap-3">
                            {% with primer_silabo=silabos_grupo.0 %}
                            <span class="badge" style="background-color: var(--color-azul-2);">{{ primer_silabo.carrera }}</span>
                            <span class="badge" style="background-color: var(--color-azul-3);">{{ primer_silabo.fecha|date:"d/m/Y" }}</span>
                            <span class="badge" style="background-color: var(--color-azul-oscuro);">
                                <i class="fas fa-calendar-check me-1"></i>
                                Encuentros: {{ silabos_grupo|length }}/12
                            </span>
                            {% endwith %}
                        </div>
                    </div>
                </button>
            </h2>
            <div id="collapse-{{ codigo }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading-{{ codigo }}" data-bs-parent="#accordionSilabos">
                <div class="accordion-body p-3">
                    <!-- Filtro por número de encuentro -->
                    <div class="mb-4 filter-buttons">
                        <div class="d-flex flex-wrap align-items-center gap-2">
                            <span class="fw-bold me-2">
                                <i class="fas fa-filter me-1"></i>
                                Filtrar por encuentro:
                            </span>
                            {% for silabo in silabos_grupo|dictsort:"encuentros" %}
                            <button class="btn btn-sm btn-outline-primary btn-encuentro-{{ codigo }} btn-encuentro-{{ codigo }}-{{ silabo.encuentros }}" 
                                    onclick="filtrarPorEncuentro('{{ codigo }}', '{{ silabo.encuentros }}')"
                                    data-encuentro="{{ silabo.encuentros }}">
                                <i class="fas fa-chalkboard-teacher me-1"></i>
                                Encuentro {{ silabo.encuentros }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="silabo-container">
                        {% for silabo in silabos_grupo|dictsort:"encuentros" %}
                        <div class="container mb-5 plan-{{ codigo }} plan-{{ codigo }}-{{ silabo.encuentros }}">
                            <div class="plan-card">
                                <div class="plan-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h4 class="mb-0">
                                            <i class="fas fa-calendar-day me-2"></i>
                                            Encuentro {{ silabo.encuentros }}
                                        </h4>
                                        <div>
                                            <span class="badge bg-light text-dark">
                                                <i class="far fa-calendar-alt me-1"></i>
                                                {{ silabo.fecha|date:"d/m/Y" }}
                                            </span>
                                            <button class="btn btn-sm btn-light ms-2" onclick="imprimirSilabo()">
                                                <i class="fas fa-print"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="plan-content p-4">
                                    <div class="row g-4">
                                        <!-- Primera columna -->
                                        <div class="col-md-6">
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    DATOS GENERALES
                                                </h5>
                                                <table class="data-table">
                                                    <tr>
                                                        <td>N° de encuentro:</td>
                                                        <td>{{ silabo.encuentros }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Municipio:</td>
                                                        <td>JALAPA</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Año lectivo:</td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Carrera:</td>
                                                        <td>{{ silabo.carrera }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Asignatura:</td>
                                                        <td>{{ silabo.asignatura.asignatura }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Facilitador:</td>
                                                        <td>{{ silabo.maestro }}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <!-- Segunda columna -->
                                        <div class="col-md-6">
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-calendar-week me-2"></i>
                                                    INFORMACIÓN ACADÉMICA
                                                </h5>
                                                <table class="data-table">
                                                    <tr>
                                                        <td>Fecha:</td>
                                                        <td>{{ silabo.fecha }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Código grupo:</td>
                                                        <td></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Trimestre:</td>
                                                        <td>{{ silabo.asignatura.trimestre }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Año de la carrera:</td>
                                                        <td>{{ silabo.asignatura.año }}</td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                        
                                        <!-- Contenido principal -->
                                        <div class="col-12">
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-bookmark me-2"></i>
                                                    UNIDAD
                                                </h5>
                                                <div class="content-item">
                                                    <h6>{{ silabo.unidad }}</h6>
                                                    <p>{{ silabo.detalle_unidad }}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-list-ul me-2"></i>
                                                    CONTENIDO DE LA CLASE
                                                </h5>
                                                <div class="content-item">
                                                    <p><strong>1)</strong> {{ silabo.contenido_tematico }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>2)</strong> {{ silabo.contenido_tematico }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>3)</strong> {{ silabo.contenido_tematico }}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-bullseye me-2"></i>
                                                    OBJETIVOS DE LA CLASE
                                                </h5>
                                                <div class="content-item">
                                                    <p><strong>Conceptual:</strong> {{ silabo.objetivo_conceptual }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>Procedimental:</strong> {{ silabo.objetivo_procedimental }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>Actitudinal:</strong> {{ silabo.objetivo_actitudinal }}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-chalkboard me-2"></i>
                                                    ESTRATEGIAS DE ENSEÑANZA
                                                </h5>
                                                <div class="content-item">
                                                    <p><strong>Primer momento:</strong> {{ silabo.momento_didactico_primer }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>Segundo momento:</strong> {{ silabo.momento_didactico_segundo }}</p>
                                                </div>
                                                <div class="content-item">
                                                    <p><strong>Tercer momento:</strong> {{ silabo.momento_didactico_tercer }}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-project-diagram me-2"></i>
                                                    APLICACIÓN DE LOS EJES
                                                </h5>
                                                <div class="content-item">
                                                    <p>{{ silabo.eje_transversal }}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="plan-section">
                                                <h5 class="plan-section-title">
                                                    <i class="fas fa-comment me-2"></i>
                                                    OBSERVACIONES
                                                </h5>
                                                <div class="content-item">
                                                    <p></p>
                                                </div>
                                                <div class="text-end mt-3">
                                                    <p><strong>Revisado por:</strong> _______________________</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
