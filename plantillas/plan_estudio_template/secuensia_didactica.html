{% load static %}

<style>
    /* Variables */
    :root {
        --guia-gris-claro: #f5f8fa;
        --guia-gris-borde: #e5e8eb;
        --guia-border-radius: 8px;
        --guia-box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        --guia-transition: all 0.2s ease-in-out;
        --color-azul-oscuro: #1B4F72;
        --color-azul-2: #2874A6;
        --color-azul-3: #2E86C1;
    }
    .tabla-scroll {
        overflow-x: auto;
        width: 100%;
        margin-bottom: 15px;
    }

    /* Agregamos estilos responsivos para todas las tablas */
    .table-container {
        overflow-x: auto;
        width: 100%;
        margin-bottom: 15px;
    }

    .data-table {
        min-width: 100%;
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
    }

    /* En dispositivos pequeños */
    @media (max-width: 768px) {
        .data-table {
            min-width: 800px; /* Ancho mínimo para asegurar scroll en móviles */
        }
    }

    .data-table th,
    .data-table td {
        border: 1px solid #ccc;
        padding: 8px;
        vertical-align: top;
        text-align: left;
        word-wrap: break-word; /* para que el texto largo se divida */
        word-break: break-word;
        white-space: normal; /* permite que el texto haga salto de línea */
    }

    .data-table th {
        background-color: #f5f5f5;
    }

    /* Anchos de columnas */
    .col-tema { width: 15%; }
    .col-fase { width: 16%; }
    .col-forma { width: 15%; }
    .col-descripcion { width: 35%; }
    .col-recursos { width: 15%; }
    .col-tiempo { width: 10%; }
    
    /* Contenedor principal */
    .guia-container {
        background-color: white;
        border-radius: var(--guia-border-radius);
        box-shadow: var(--guia-box-shadow);
        margin: 0;
        overflow: hidden;
    }
    
    .guia-component .main-content {
        display: none;
    }
    
    .guia-component .main-content.active {
        display: block;
    }
    
    /* Navegación de encuentros */
    .guia-component .encuentros-nav {
        display: flex;
        background-color: white;
        overflow-x: auto;
        padding: 15px;
        gap: 8px;
        border-bottom: 1px solid var(--guia-gris-borde);
    }
    
    .guia-component .encuentro-tab {
        background-color: var(--guia-gris-claro);
        border: 1px solid var(--guia-gris-borde);
        border-radius: 50px;
        padding: 8px 16px;
        min-width: 40px;
        text-align: center;
        cursor: pointer;
        transition: var(--guia-transition);
        font-weight: 600;
        color: var(--color-azul-oscuro);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .guia-component .encuentro-tab.active {
        background-color: var(--color-azul-3);
        color: white;
        border-color: var(--color-azul-3);
    }
    
    .guia-component .encuentro-tab:hover:not(.active) {
        background-color: rgba(46, 134, 193, 0.1);
        transform: translateY(-2px);
    }
    
    /* Contenido del encuentro */
    .guia-component .encuentro-content {
        display: none;
        padding: 20px;
    }
    
    .guia-component .encuentro-content.active {
        display: block;
    }
    
    /* Secciones de datos */
    .guia-component .data-section {
        margin-bottom: 24px;
        border-bottom: 1px solid var(--guia-gris-borde);
        padding-bottom: 20px;
    }
    
    .guia-component .data-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .guia-component .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--color-azul-oscuro);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .guia-component .section-title i {
        font-size: 1.2rem;
    }
    
    .guia-component .data-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 16px;
    }
    
    .guia-component .data-card {
        background-color: var(--guia-gris-claro);
        border-radius: var(--guia-border-radius);
        padding: 12px 16px;
    }
    
    .guia-component .card-title {
        color: var(--color-azul-2);
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 4px;
    }
    
    .guia-component .card-value {
        font-weight: 500;
        color: #333;
    }
    
    /* Tablas */
    .guia-component .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 16px;
    }
    
    .guia-component .data-table th {
        background-color: var(--guia-gris-claro);
        color: var(--color-azul-oscuro);
        font-weight: 600;
        text-align: left;
        padding: 10px 16px;
        border: 1px solid var(--guia-gris-borde);
    }
    
    .guia-component .data-table td {
        padding: 10px 16px;
        border: 1px solid var(--guia-gris-borde);
        vertical-align: top;
    }
    
    .guia-component .data-table tr:nth-child(even) {
        background-color: rgba(245, 248, 250, 0.5);
    }
    
    .guia-component .data-table tr:hover {
        background-color: rgba(46, 134, 193, 0.05);
    }
    
    /* Botón para imprimir */
    .guia-component .print-button {
        background-color: var(--color-azul-3);
        color: white;
        border: none;
        border-radius: var(--guia-border-radius);
        padding: 8px 16px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 15px 20px;
        transition: var(--guia-transition);
    }
    
    .guia-component .print-button:hover {
        background-color: var(--color-azul-2);
        transform: translateY(-2px);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .guia-component .data-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Estilos para impresión */
    @media print {
        body {
            font-size: 12pt;
            background: white;
            --guia-box-shadow: none;
        }
        
        .guia-component .main-content,
        .guia-component .encuentro-content {
            display: block !important;
        }
        
        .guia-component table th,
        .guia-component table td {
            border: 1px solid #ddd;
        }
        
        .guia-component .print-button,
        .guia-component .encuentros-nav {
            display: none !important;
        }
    }
</style>

<div class="container mt-4 guia-component">
    <!-- Botón para descargar documento completo -->
 
    
    <!-- Acordeón -->
    <div class="accordion" id="guiaAccordion">
        {% for codigo, silabos_grupo in silabos_agrupados.items %}
        <div class="accordion-item mb-4">
            <h2 class="accordion-header" id="heading-{{ codigo }}">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ codigo }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="collapse-{{ codigo }}">
                    <div class="d-flex flex-column flex-md-row justify-content-between w-100">
                        <div>
                            <a href="{% url 'descargar_secuencia_didactica' %}" class="btn btn-primary">
                                <i class="fas fa-file-word"></i> 
                                {% with first_silabo=silabos_grupo|first %}
                                {{ first_silabo.asignatura.nombre }}
                                {% endwith %}
                            </a>
                        </div>
                        <div class="d-flex gap-3">
                            {% with primer_silabo=silabos_grupo.0 %}
                            <span class="badge" style="background-color: var(--color-azul-2);">{{ primer_silabo.carrera }}</span>
                            <span class="badge" style="background-color: var(--color-azul-3);">{{ primer_silabo.fecha|date:"d/m/Y" }}</span>
                            <span class="badge" style="background-color: var(--color-azul-oscuro);">
                                <i class="fas fa-calendar-check me-1"></i>
                                Encuentros: {{ silabos_grupo|length }}/12
                            </span>
                            {% endwith %}
                        </div>
                    </div>
                </button>
            </h2>
            <div id="collapse-{{ codigo }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="heading-{{ codigo }}" data-bs-parent="#guiaAccordion">
                <div class="accordion-body p-0">
                    <div class="guia-container">
                        <!-- Navegación de encuentros -->
                        <div class="encuentros-nav">
                            {% for silabo in silabos_grupo|dictsort:"encuentros" %}
                            <div class="encuentro-tab {% if forloop.first %}active{% endif %}" data-target="guia-encuentro-{{ silabo.encuentros }}-{{ codigo }}">
                                {{ silabo.encuentros }}
                            </div>
                            {% endfor %}
                        </div>
                            
                        <!-- Contenido de cada encuentro -->
                        {% for silabo in silabos_grupo|dictsort:"encuentros" %}
                        <div class="encuentro-content {% if forloop.first %}active{% endif %}" id="guia-encuentro-{{ silabo.encuentros }}-{{ codigo }}">
                            <!-- Información básica -->
                            <div class="data-section">
                                <h2 class="text-center mb-4">UNIVERSIDAD MARTÍN LUTERO</h2>
                                <h3 class="text-center mb-4">SECUENCIA DIDÁCTICA</h3>
                                
                                <!-- Datos Generales del Sílabo -->
                                <div class="data-section">
                                    <h3 class="section-title">
                                        <i class="fas fa-info-circle"></i>
                                        Datos Generales
                                    </h3>
                                    <div class="data-card">
                                        <div class="table-container">
                                            <table class="data-table">
                                                <tr>
                                                    <td>N° de guia:</td>
                                                    <td>{{ silabo.encuentros }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Fecha:</td>
                                                    <td>{{ silabo.fecha|date:"d/m/Y" }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Sede:</td>
                                                    <td>Jalapa</td>
                                                </tr>
                                                <tr>
                                                    <td>Carrera:</td>
                                                    <td>{{ silabo.plan_de_estudio.carrera.nombre }}</td>
                                                </tr>
                                                
                                                <tr>
                                                    <td>Mediador:</td>
                                                    <td>{{ usuario }}</td>
                                                </tr>
                                                
                                                <tr>
                                                    <td>Año académico:</td>
                                                    <td>{{ silabo.plan_de_estudio.año }}</td>
                                                </tr>

                                                <tr>
                                                    <td>Asignatura:</td>
                                                    <td>{{ silabo.plan_de_estudio.asignatura }}</td>
                                                </tr>

                                                <tr>
                                                    <td>Cód. de asignatura:</td>
                                                    <td>{{ silabo.plan_de_estudio.codigo }}</td>
                                                </tr>

                                                <tr>
                                                    <td>Trimestre:</td>
                                                    <td>{{ silabo.plan_de_estudio.trimestre }}</td>
                                                </tr>

                                                <tr>
                                                    <td>Año Lectivo:</td>
                                                    <td>{{ año_actual }}</td>
                                                </tr>
                                                
                                            </table>
                                        </div>
                                    </div>
                                </div>


                                <!-- Nombre de la Unidad -->
                                <h4 class="mt-4 mb-3 text-center">Nombre de la Unidad</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <tbody>
                                            <tr>
                                                <td colspan="2" class="text-center"><strong>{{ silabo.unidad }}. {{ silabo.nombre_de_la_unidad }}</strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Objetivos de la unidad -->
                                <h4 class="mt-4 mb-3">Objetivos de la unidad</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <tbody>
                                            <tr>
                                                <td width="20%">Conceptual</td>
                                                <td>{{ silabo.objetivo_conceptual }}</td>
                                            </tr>
                                            <tr>
                                                <td>Procedimental</td>
                                                <td>{{ silabo.objetivo_procedimental }}</td>
                                            </tr>
                                            <tr>
                                                <td>Actitudinal</td>
                                                <td>{{ silabo.objetivo_actitudinal }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- MEDIACIÓN PEDAGÓGICA -->
                                <h4 class="mt-4 mb-3 text-center">MEDIACIÓN PEDAGÓGICA</h4>
                                <div class="tabla-scroll" style="overflow-x: auto; max-width: 100%;">
                                    <table class="data-table">
                                      <thead>
                                        <tr>
                                          <th class="col-tema">Contenido temático</th>
                                          <th class="col-fase" style="width: 16%;">Fases</th>
                                          <th class="col-forma">Forma organizativa</th>
                                          <th class="col-descripcion">Descripción de la forma organizativa</th>
                                          <th class="col-recursos">Recursos didácticos</th>
                                          <th class="col-tiempo">Tiempo</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr>
                                          <td rowspan="6">
                                            {{ silabo.contenido_tematico }}
                                          </td>
                                          <td rowspan="2"><strong>Primer momento</strong><br>(Entrada)</td>
                                          <td>{{ silabo.tipo_primer_momento }}</td>
                                          <td>
                                            {{ silabo.detalle_primer_momento }}
                                          </td>
                                          <td>{{ silabo.recursos_primer_momento }}</td>
                                          <td>{{ silabo.tiempo_primer_momento }}</td>
                                        </tr>
                                        
                                        <tr>
                                          <td>—</td>
                                          <td>—</td>
                                          <td>—</td>
                                          <td>—</td>
                                        </tr>

                                        <tr>
                                          <td rowspan="2"><strong>Segundo momento</strong><br>(Elaboración)</td>
                                          <td>Clases teóricas - {{ silabo.tipo_segundo_momento_claseteoria }}</td>
                                          <td>
                                            {{ silabo.clase_teorica }}
                                          </td>
                                          <td rowspan="2">Computadora, guía, video</td>
                                          <td>30</td>
                                        </tr>

                                        

                                        <tr>
                                          <td>Clases prácticas - Evaluación formativa</td>
                                          <td>
                                            Trabajo en grupos: ejercicios prácticos sobre arquitecturas.
                                          </td>
                                          <td>20</td>
                                        </tr>

                                        <tr>
                                          <td>—</td>
                                          <td>—</td>
                                          <td>—</td>
                                          <td>—</td>
                                          <td>—</td>
                                        </tr>

                                        <tr>
                                          <td><strong>Tercer momento</strong><br>(Salida)</td>
                                          <td>Realimentación y orientación</td>
                                          <td>
                                            Resumen del tema, aclaración de dudas, tareas para autoestudio.
                                          </td>
                                          <td>Pizarra, guía</td>
                                          <td>20</td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </div>
                                
                                
                                <h4 class="mt-4 mb-3">Orientaciones de las actividades de aprendizaje</h4>
                                
                                <!-- Actividad de Aprendizaje -->
                                <div class="table-container" style="overflow-x: auto; max-width: 100%;">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Descripcion de la actividad de Aprendizaje</th>
                                                <th>Evaluación de la actividad de Aprendizaje</th>
                                                <th>Período</th>
                                                <th>Tiempo en minutos</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{% if silabo.actividad_aprendizaje %}{{ silabo.actividad_aprendizaje }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    <strong>Tipo de Evaluación</strong><br>
                                                    {% if silabo.tipo_evaluacion %}{{ silabo.tipo_evaluacion }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    <strong>Instrumento de evaluación</strong><br><br>
                                                    {% if silabo.instrumento_evaluacion %}{{ silabo.instrumento_evaluacion }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.periodo_tiempo_programado %}{{ silabo.periodo_tiempo_programado }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    <strong>Tecnica evaluacion</strong><br>
                                                    {% if silabo.tecnica_evaluacion %}{{ silabo.tecnica_evaluacion }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.tiempo_minutos %}{{ silabo.tiempo_minutos }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                   <strong>Puntaje</strong><br>
                                                    {% if silabo.puntaje %}{{ silabo.puntaje }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="table-container mt-3">
                                    <table class="data-table">
                                        <tbody>
                                            <tr>
                                                <td style="text-align: center;"><strong>TOTAL HORAS</strong></td>
                                                <td width="10%"><strong>
                                                {% with total_minutos=silabo.tiempo_primer_momento|add:silabo.tiempo_segundo_momento_teorica|add:silabo.tiempo_segundo_momento_practica|add:silabo.tiempo_tercer_momento|add:silabo.tiempo_minutos %}
                                                    {% widthratio total_minutos 60 1 as horas_decimal %}
                                                    {{ horas_decimal|floatformat:2 }}
                                                {% endwith %}
                                                </strong></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <h4 class="mt-4 mb-3">Eje transversal</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th width="30%">Eje</th>
                                                <th>Descripción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>{% if silabo.eje_transversal %}{{ silabo.eje_transversal }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</strong></td>
                                                <td>
                                                    {% if silabo.detalle_eje_transversal %}
                                                        {{ silabo.detalle_eje_transversal|safe }}
                                                    {% else %}
                                                        <span style="color: #FDA172;">SinDatos</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- GUÍA AUTODIDÁCTICA DE APRENDIZAJE -->
                                <h3 class="mt-5 mb-3 text-center">GUÍA AUTODIDÁCTICA DE APRENDIZAJE</h3>
                                
                                <!-- Tarea 1 -->
                                <h4 class="mt-4 mb-3">Actividad de Aprendizaje 1</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Unidad</th>
                                                <th>Objetivo</th>
                                                <th>Contenido Temático</th>
                                                <th>Actividad de Aprendizaje</th>
                                                <th>Evaluación</th>
                                                <th>Período</th>
                                                <th>Tiempo en minutos</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{% if silabo.guia.nombre_de_la_unidad %}{{ silabo.guia.nombre_de_la_unidad }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    {% if silabo.guia.tipo_objetivo_1 %}{{ silabo.guia.tipo_objetivo_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}:<br>
                                                    {% if silabo.guia.objetivo_aprendizaje_1 %}{{ silabo.guia.objetivo_aprendizaje_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.contenido_tematico_1 %}{{ silabo.guia.contenido_tematico_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>{% if silabo.guia.actividad_aprendizaje_1 %}{{ silabo.guia.actividad_aprendizaje_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    Tipo de evaluación: {% if silabo.guia.tipo_evaluacion_1 %}{{ silabo.guia.tipo_evaluacion_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Instrumento de evaluación: {% if silabo.guia.instrumento_evaluacion_1 %}{{ silabo.guia.instrumento_evaluacion_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Recursos didácticos: {% if silabo.guia.recursos_didacticos_1 %}{{ silabo.guia.recursos_didacticos_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.guia.periodo_tiempo_programado_1 %}{{ silabo.guia.periodo_tiempo_programado_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Puntaje: {% if silabo.guia.puntaje_1 %}{{ silabo.guia.puntaje_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Fecha de entrega: {% if silabo.guia.fecha_entrega_1 %}{{ silabo.guia.fecha_entrega_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.tiempo_minutos_1 %}{{ silabo.guia.tiempo_minutos_1 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Tarea 2 -->
                                <h4 class="mt-4 mb-3">Actividad de Aprendizaje 2</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Unidad</th>
                                                <th>Objetivo</th>
                                                <th>Contenido Temático</th>
                                                <th>Actividad de Aprendizaje</th>
                                                <th>Evaluación</th>
                                                <th>Período</th>
                                                <th>Tiempo en minutos</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{% if silabo.guia.nombre_de_la_unidad %}{{ silabo.guia.nombre_de_la_unidad }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    {% if silabo.guia.tipo_objetivo_2 %}{{ silabo.guia.tipo_objetivo_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}:<br>
                                                    {% if silabo.guia.objetivo_aprendizaje_2 %}{{ silabo.guia.objetivo_aprendizaje_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.contenido_tematico_2 %}{{ silabo.guia.contenido_tematico_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>{% if silabo.guia.actividad_aprendizaje_2 %}{{ silabo.guia.actividad_aprendizaje_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    Tipo de evaluación: {% if silabo.guia.tipo_evaluacion_2 %}{{ silabo.guia.tipo_evaluacion_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Instrumento de evaluación: {% if silabo.guia.instrumento_evaluacion_2 %}{{ silabo.guia.instrumento_evaluacion_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Recursos didácticos: {% if silabo.guia.recursos_didacticos_2 %}{{ silabo.guia.recursos_didacticos_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.guia.periodo_tiempo_programado_2 %}{{ silabo.guia.periodo_tiempo_programado_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Puntaje: {% if silabo.guia.puntaje_2 %}{{ silabo.guia.puntaje_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Fecha de entrega: {% if silabo.guia.fecha_entrega_2 %}{{ silabo.guia.fecha_entrega_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.tiempo_minutos_2 %}{{ silabo.guia.tiempo_minutos_2 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Tarea 3 -->
                                <h4 class="mt-4 mb-3">Actividad de Aprendizaje 3</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Unidad</th>
                                                <th>Objetivo</th>
                                                <th>Contenido Temático</th>
                                                <th>Actividad de Aprendizaje</th>
                                                <th>Evaluación</th>
                                                <th>Período</th>
                                                <th>Tiempo en minutos</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{% if silabo.guia.nombre_de_la_unidad %}{{ silabo.guia.nombre_de_la_unidad }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    {% if silabo.guia.tipo_objetivo_3 %}{{ silabo.guia.tipo_objetivo_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}:<br>
                                                    {% if silabo.guia.objetivo_aprendizaje_3 %}{{ silabo.guia.objetivo_aprendizaje_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.contenido_tematico_3 %}{{ silabo.guia.contenido_tematico_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>{% if silabo.guia.actividad_aprendizaje_3 %}{{ silabo.guia.actividad_aprendizaje_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    Tipo de evaluación: {% if silabo.guia.tipo_evaluacion_3 %}{{ silabo.guia.tipo_evaluacion_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Instrumento de evaluación: {% if silabo.guia.instrumento_evaluacion_3 %}{{ silabo.guia.instrumento_evaluacion_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Recursos didácticos: {% if silabo.guia.recursos_didacticos_3 %}{{ silabo.guia.recursos_didacticos_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.guia.periodo_tiempo_programado_3 %}{{ silabo.guia.periodo_tiempo_programado_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Puntaje: {% if silabo.guia.puntaje_3 %}{{ silabo.guia.puntaje_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Fecha de entrega: {% if silabo.guia.fecha_entrega_3 %}{{ silabo.guia.fecha_entrega_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.tiempo_minutos_3 %}{{ silabo.guia.tiempo_minutos_3 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <!-- Tarea 4 -->
                                <h4 class="mt-4 mb-3">Actividad de Aprendizaje 4</h4>
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Unidad</th>
                                                <th>Objetivo</th>
                                                <th>Contenido Temático</th>
                                                <th>Actividad de Aprendizaje</th>
                                                <th>Evaluación</th>
                                                <th>Período</th>
                                                <th>Tiempo en minutos</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>{% if silabo.guia.nombre_de_la_unidad %}{{ silabo.guia.nombre_de_la_unidad }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    {% if silabo.guia.tipo_objetivo_4 %}{{ silabo.guia.tipo_objetivo_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}:<br>
                                                    {% if silabo.guia.objetivo_aprendizaje_4 %}{{ silabo.guia.objetivo_aprendizaje_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.contenido_tematico_4 %}{{ silabo.guia.contenido_tematico_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>{% if silabo.guia.actividad_aprendizaje_4 %}{{ silabo.guia.actividad_aprendizaje_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                <td>
                                                    Tipo de evaluación: {% if silabo.guia.tipo_evaluacion_4 %}{{ silabo.guia.tipo_evaluacion_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Instrumento de evaluación: {% if silabo.guia.instrumento_evaluacion_4 %}{{ silabo.guia.instrumento_evaluacion_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Recursos didácticos: {% if silabo.guia.recursos_didacticos_4 %}{{ silabo.guia.recursos_didacticos_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>
                                                    {% if silabo.guia.periodo_tiempo_programado_4 %}{{ silabo.guia.periodo_tiempo_programado_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Puntaje: {% if silabo.guia.puntaje_4 %}{{ silabo.guia.puntaje_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}<br><br>
                                                    Fecha de entrega: {% if silabo.guia.fecha_entrega_4 %}{{ silabo.guia.fecha_entrega_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}
                                                </td>
                                                <td>{% if silabo.guia.tiempo_minutos_4 %}{{ silabo.guia.tiempo_minutos_4 }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                    
                                
                                <!-- Resumen de horas y puntajes -->
                                <div class="container-fluid mt-5">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="table-container">
                                                <table class="data-table">
                                                    <tbody>
                                                        <tr>
                                                            <td>Horas presenciales:</td>
                                                            <td width="20%">
                                                                {% with total_minutos=silabo.tiempo_primer_momento|add:silabo.tiempo_segundo_momento_teorica|add:silabo.tiempo_segundo_momento_practica|add:silabo.tiempo_tercer_momento|add:silabo.tiempo_minutos %}
                                                                {% widthratio total_minutos 60 1 as horas_decimal %}
                                                                {{ horas_decimal|floatformat:2 }}
                                                                {% endwith %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>Horas de estudio independiente:</td>
                                                            <td>
                                                                {% with total_minutos=silabo.guia.tiempo_minutos_1|add:silabo.guia.tiempo_minutos_2|add:silabo.guia.tiempo_minutos_3|add:silabo.guia.tiempo_minutos_4 %}
                                                                {% widthratio total_minutos 60 1 as horas_decimal %}
                                                                {{ horas_decimal|floatformat:2 }}
                                                                {% endwith %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Total de horas:</strong></td>
                                                            <td>
                                                                {% with presencial_minutos=silabo.tiempo_primer_momento|add:silabo.tiempo_segundo_momento_teorica|add:silabo.tiempo_segundo_momento_practica|add:silabo.tiempo_tercer_momento|add:silabo.tiempo_minutos %}
                                                                {% with independiente_minutos=silabo.guia.tiempo_minutos_1|add:silabo.guia.tiempo_minutos_2|add:silabo.guia.tiempo_minutos_3|add:silabo.guia.tiempo_minutos_4 %}
                                                                {% with total_minutos=presencial_minutos|add:independiente_minutos %}
                                                                {% widthratio total_minutos 60 1 as horas_decimal %}
                                                                {{ horas_decimal|floatformat:2 }}
                                                                {% endwith %}
                                                                {% endwith %}
                                                                {% endwith %}
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="table-container">
                                                <table class="data-table">
                                                    <tbody>
                                                        <tr>
                                                            <td>Puntaje en actividad de aprendizaje presencial:</td>
                                                            <td width="20%">{% if silabo.puntaje %}{{ silabo.puntaje }}{% else %}<span style="color: #FDA172;">SinDatos</span>{% endif %}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Puntaje en estudio independiente:</td>
                                                            <td>
                                                                {% with total_puntaje_independiente=silabo.guia.puntaje_1|add:silabo.guia.puntaje_2|add:silabo.guia.puntaje_3|add:silabo.guia.puntaje_4 %}
                                                                    {% if total_puntaje_independiente > 0 %}
                                                                        {{ total_puntaje_independiente }}
                                                                    {% else %}
                                                                        <span style="color: #FDA172;">SinDatos</span>
                                                                    {% endif %}
                                                                {% endwith %}
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Puntaje Total:</strong></td>
                                                            <td>
                                                                
                                                                    {% with total_puntaje_independiente=silabo.guia.puntaje_1|add:silabo.guia.puntaje_2|add:silabo.guia.puntaje_3|add:silabo.guia.puntaje_4 %}
                                                                    {% with puntaje_total=silabo.puntaje|add:total_puntaje_independiente %}
                                                                        {% if puntaje_total > 0 %}
                                                                            {{ puntaje_total }}
                                                                        {% else %}
                                                                            <span style="color: #FDA172;">SinDatos</span>
                                                                        {% endif %}
                                                                    {% endwith %}
                                                                    {% endwith %}
                                                                
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // JavaScript para la navegación entre encuentros y vistas principales
    document.addEventListener('DOMContentLoaded', function() {
        // Función para cambiar entre encuentros
        function switchEncuentro(targetId, tabs, contents) {
            // Desactivar todas las pestañas y contenidos
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            // Activar la pestaña y contenido seleccionados
            const selectedTab = document.querySelector(`.encuentro-tab[data-target="${targetId}"]`);
            const selectedContent = document.getElementById(targetId);
            
            if (selectedTab && selectedContent) {
                selectedTab.classList.add('active');
                selectedContent.classList.add('active');
            }
        }
        
        // Usar delegación de eventos para las pestañas de encuentros
        document.querySelectorAll('.encuentros-nav').forEach(nav => {
            nav.addEventListener('click', function(e) {
                const tab = e.target.closest('.encuentro-tab');
                if (!tab) return; // Si el clic no fue en una pestaña, salir
                
                const targetId = tab.getAttribute('data-target');
                const container = this.closest('.guia-container');
                const tabs = container.querySelectorAll('.encuentro-tab');
                const contents = container.querySelectorAll('.encuentro-content');
                
                switchEncuentro(targetId, tabs, contents);
            });
        });
        
        // Inicializar para el primer acordeón si está abierto
        const firstAccordion = document.querySelector('.accordion-collapse.show');
        if (firstAccordion) {
            const container = firstAccordion.querySelector('.guia-container');
            const firstTab = container.querySelector('.encuentro-tab.active');
            
            if (firstTab) {
                const targetId = firstTab.getAttribute('data-target');
                const tabs = container.querySelectorAll('.encuentro-tab');
                const contents = container.querySelectorAll('.encuentro-content');
                
                switchEncuentro(targetId, tabs, contents);
            }
        }
        
        // Manejar eventos de acordeón para cargar el contenido apropiado cuando se abre
        document.querySelectorAll('.accordion-button').forEach(button => {
            button.addEventListener('click', function() {
                const isExpanded = this.getAttribute('aria-expanded') === 'true';
                if (!isExpanded) { // Si se está expandiendo ahora
                    setTimeout(() => {
                        const container = this.closest('.accordion-item').querySelector('.guia-container');
                        if (container) {
                            const firstTab = container.querySelector('.encuentro-tab.active') || container.querySelector('.encuentro-tab');
                            if (firstTab) {
                                const targetId = firstTab.getAttribute('data-target');
                                const tabs = container.querySelectorAll('.encuentro-tab');
                                const contents = container.querySelectorAll('.encuentro-content');
                                
                                switchEncuentro(targetId, tabs, contents);
                            }
                        }
                    }, 350); // Esperar a que termine la animación del acordeón
                }
            });
        });
    });
</script>
